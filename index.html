
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>SISTEMA DE AUTORIZACIONES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    :root {
      --verde-ferro: #014421;
      --gris-claro: #f8f9fa;
      --gris-borde: #dee2e6;
    }
    * {
      box-sizing: border-box;
    }
    body {
      background: var(--gris-claro);
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 2rem;
      color: #212529;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 2rem 3rem;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--gris-borde);
    }
    input, select, textarea, button {
      font-family: 'Inter', sans-serif;
    }
    input[type="text"], input[type="email"], select {
      padding: 0.5rem;
      border-radius: 6px;
      border: 1px solid #ced4da;
      margin-top: 0.25rem;
    }
    h1 {
      color: var(--verde-ferro);
      font-size: 28px;
      text-align: center;
      margin-bottom: 2rem;
    }
    h2 {
      font-size: 22px;
      color: #333;
      margin-top: 1.5rem;
    }
    label, legend {
      font-weight: 500;
      margin-top: 1rem;
    }
    fieldset {
      border: none;
      padding: 0;
      margin: 1rem 0;
    }
    .checkbox-group label {
      font-weight: 400;
      margin: 0.5rem 0;
    }
    button {
      padding: 0.7rem 1.5rem;
      background-color: var(--verde-ferro);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background-color: #013b1d;
    }
    .admin {
      background: #f1fdf5;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px dashed var(--verde-ferro);
      margin-top: 2rem;
    }
    .file-link {
      margin-top: 0.5rem;
      display: inline-block;
      font-size: 0.875rem;
      color: #0056b3;
    }
    #lista-actividades button {
      margin-right: 1rem;
    }

    body { font-family: 'Inter', sans-serif; font-size: 16px; }
    label, select, input, legend, .file-link { font-size: 16px; }
    h1, h2 { font-size: 26px; }
    button { font-size: 16px; }

    :root {
      --verde-ferro: #014421;
      --verde-claro: #e0f7e0;
    }
    body { font-family: "Segoe UI", sans-serif; background: #f4fdf6; margin: 0; padding: 1rem; }
    .container { max-width: 750px; margin: auto; background: #fff; padding: 2rem 3rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h1 { text-align: center; }
    label, select, input { display: block; width: 100%; margin-top: 1rem; }
    fieldset { margin-top: 1rem; }
    button { margin-top: 1rem; padding: 0.6rem 1.2rem; font-weight: 600; background: var(--verde-ferro); color: white; border: none; border-radius: 5px; cursor: pointer; }
    .checkbox-group label { margin-top: 0.5rem; display: block; }
    .admin { background: var(--verde-claro); padding: 1.5rem; margin-top: 2rem; border: 2px dashed var(--verde-ferro); border-radius: 10px; border-radius: 10px; margin-top: 2rem; display: none; }
    .file-link { margin-left: 1.5rem; font-size: 0.9rem; color: blue; }
  </style>
</head>
<body>
<div class="container">
  <img src="https://media.licdn.com/dms/image/v2/C4D0BAQGO24tD1BZ4Dw/company-logo_200_200/company-logo_200_200/0/1669252336076?e=2147483647&v=beta&t=ExfLk7aRKGbBapo68doDXQ_o-vNoab7BQh31dkmq48w" style="display:block; margin:auto; max-height:100px;" />
  <h1 style="color: var(--verde-ferro);">SISTEMA DE AUTORIZACIONES</h1>
  <form onsubmit="enviarFormulario(event)">
    <label>Nombre del alumno:<input id="alumno" required></label>
    <label>Año:
      <select id="año" required>
        <option value="">Seleccionar año</option><option>1°</option><option>2°</option><option>3°</option><option>4°</option><option>5°</option>
      </select>
    </label>
    <label>División:
      <select id="division" required>
        <option value="">Seleccionar división</option><option>A</option><option>B</option><option>C</option><option>D</option>
      </select>
    </label>
    <label>Turno:
      <select id="turno" required>
        <option value="">Seleccionar turno</option><option>Turno Mañana</option><option>Turno Tarde</option>
      </select>
    </label>
    <label>Nombre del tutor:<input id="tutor" required></label>
    <label>Email del tutor:<input id="email" type="email" required></label>
    <fieldset class="checkbox-group"><legend>Actividad/es a autorizar:</legend></fieldset>
    <button type="submit">Enviar autorización</button>
  </form>
  <div style="text-align:center;">
    <button id="btn-admin">🛠 Editar actividades</button>
  </div>
  <div id="admin-panel" class="admin">
    <h2>Panel de Administración</h2>
    <input id="nueva-actividad" placeholder="Nombre de la actividad">
    <div id="editor-nuevo" style="background:white;"></div>
    <input type="file" id="archivo-actividad" accept=".pdf,.jpg,.png,.doc,.docx,.xls,.xlsx">
    <button onclick="agregarActividad()">Agregar actividad</button>
    <ul id="lista-actividades"></ul>
  </div>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script>
  const administradores = [
    "preceptoria.tm@institutoferro.edu.ar", "preceptoria.tt@institutoferro.edu.ar",
    "secretaria.secundario@institutoferro.edu.ar", "gabriela.lopez@institutoferro.edu.ar",
    "juan.vercellino@institutoferro.edu.ar", "juan.vercellino98@gmail.com",
    "juanchovercellino@gmail.com", "paula.marzan@institutoferro.edu.ar", "romina.rua@institutoferro.edu.ar"
  ];

  let quillNuevo;

  window.onload = () => {
    quillNuevo = new Quill('#editor-nuevo', { theme: 'snow' });
    cargarActividades();
    document.getElementById("btn-admin").addEventListener("click", verificarAdmin);
  };

  function verificarAdmin() {
    const email = prompt("Ingresá tu email institucional:");
    if (administradores.includes(email)) {
      document.getElementById("admin-panel").style.display = "block";
      cargarActividades();
    } else {
      alert("Acceso denegado.");
    }
  }

  function cargarActividades() {
    const acts = JSON.parse(localStorage.getItem("actividadesFerro") || "[]");
    const lista = document.getElementById("lista-actividades");
    const zona = document.querySelector(".checkbox-group");
    lista.innerHTML = "";
    zona.innerHTML = "";

    acts.forEach((act, index) => {
      const desc = localStorage.getItem("desc_" + act) || "";
      const archivo = localStorage.getItem("archivo_" + act);

      const label = document.createElement("label");
      label.innerHTML = `<input type="checkbox" name="actividad" value="${act}"> ${act}
        <div style="margin-left:1.5rem;">${desc}${archivo ? `<br><a href="${archivo}" target="_blank" class="file-link">📎 Archivo adjunto</a>` : ""}</div>`;
      zona.appendChild(label);

      const item = document.createElement("li");
      item.innerHTML = `<strong>${act}</strong>`;
      const editor = document.createElement("div");
      item.appendChild(editor);
      const quill = new Quill(editor, { theme: 'snow' });
      quill.root.innerHTML = desc;

      const guardar = document.createElement("button");
      guardar.textContent = "Guardar";
      guardar.onclick = () => {
        localStorage.setItem("desc_" + act, quill.root.innerHTML.trim());
        cargarActividades();
      };

      const eliminar = document.createElement("button");
      eliminar.textContent = "Eliminar";
      eliminar.onclick = () => {
        acts.splice(index, 1);
        localStorage.setItem("actividadesFerro", JSON.stringify(acts));
        localStorage.removeItem("desc_" + act);
        localStorage.removeItem("archivo_" + act);
        cargarActividades();
      };

      item.appendChild(guardar);
      item.appendChild(eliminar);
      lista.appendChild(item);
    });
  }

  function agregarActividad() {
    const act = document.getElementById("nueva-actividad").value.trim();
    const desc = quillNuevo.root.innerHTML.trim();
    const archivo = document.getElementById("archivo-actividad").files[0];

    if (!act) return;
    const acts = JSON.parse(localStorage.getItem("actividadesFerro") || "[]");
    acts.push(act);
    localStorage.setItem("actividadesFerro", JSON.stringify(acts));
    localStorage.setItem("desc_" + act, desc);

    if (archivo) {
      const reader = new FileReader();
      reader.onload = evt => {
        localStorage.setItem("archivo_" + act, evt.target.result);
        cargarActividades();
      };
      reader.readAsDataURL(archivo);
    } else {
      cargarActividades();
    }

    document.getElementById("nueva-actividad").value = "";
    quillNuevo.root.innerHTML = "";
    document.getElementById("archivo-actividad").value = "";
  }

  async function enviarFormulario(e) {
    e.preventDefault();
    const data = {
      nombreAlumno: document.getElementById("alumno").value,
      division: document.getElementById("division").value,
      año: document.getElementById("año").value,
      turno: document.getElementById("turno").value,
      nombreTutor: document.getElementById("tutor").value,
      emailTutor: document.getElementById("email").value,
      actividadesSeleccionadas: Array.from(document.querySelectorAll('input[name="actividad"]:checked')).map(el => el.value),
      curso: document.getElementById("año").value + "º" + document.getElementById("division").value
    };
    const response = await fetch("https://script.google.com/macros/s/AKfycbzrgCqxPYeHp_0GCdnIbPiDliky6J-SW4HK9bT0pl6nwQyB5GoOiT4ADRL2J7PXlso7dA/exec", {
      method: "POST",
      body: JSON.stringify(data),
      headers: { "Content-Type": "application/json" }
    });
    if (response.ok) {
      alert("✅ Autorización enviada con éxito.");
      document.querySelector("form").reset();
    } else {
      alert("Error al enviar.");
    }
  }
</script>
</body>
</html>
